# flutter_nfs

ä¸€ä¸ªé«˜æ€§èƒ½ã€è·¨å¹³å°çš„ Flutter **ç”¨æˆ·æ€ (User-Space)** NFS å®¢æˆ·ç«¯ï¼ŒåŸºäº `libnfs` æ„å»ºã€‚

ä¼ ç»Ÿçš„ NFS æŒ‚è½½é€šå¸¸ä¾èµ–äºæ“ä½œç³»ç»Ÿå†…æ ¸æ”¯æŒï¼ˆåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé€šå¸¸éœ€è¦ Root æƒé™ï¼‰ï¼Œè€Œ `flutter_nfs` å®Œå…¨è¿è¡Œåœ¨ç”¨æˆ·æ€åº”ç”¨ç¨‹åºè¿›ç¨‹ä¸­ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆéœ€è¦åœ¨æ— ç‰¹æƒç¯å¢ƒä¸‹è®¿é—®ç½‘ç»œå­˜å‚¨çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚æ¸¸æˆæ¨¡æ‹Ÿå™¨ã€åª’ä½“æ’­æ”¾å™¨æˆ–æ–‡ä»¶ç®¡ç†å™¨ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

*   **ç”¨æˆ·æ€å®ç°**: å®Œå…¨è¿è¡Œåœ¨åº”ç”¨å±‚ï¼Œæ— éœ€ Root æƒé™ï¼Œæ— éœ€å†…æ ¸é©±åŠ¨æ”¯æŒã€‚
*   **è·¨å¹³å°**: æ”¯æŒ **Android**ã€**iOS**ã€**macOS**ã€**Windows** å’Œ **Linux**ã€‚
*   **é«˜æ€§èƒ½**:
    *   **é›¶æ‹·è´æ¶æ„ (Zero-Copy)**: æ•°æ®ç›´æ¥ä»ç½‘ç»œ Socket è¯»å–åˆ° Dart `Uint8List` ç¼“å†²åŒºï¼Œæœ€å¤§é™åº¦å‡å°‘å†…å­˜æ‹·è´ã€‚
    *   **å—ç¼“å­˜ (Block Cache)**: å†…ç½® 128KB ç¯å½¢ç¼“å†²åŒºç¼“å­˜ï¼Œä¼˜åŒ–é¡ºåºè¯»å–æ€§èƒ½ï¼ˆç‰¹åˆ«é€‚åˆæµåª’ä½“æˆ–æ¨¡æ‹Ÿå™¨åŠ è½½ ROMï¼‰ã€‚
    *   **è¿æ¥æ± **: é«˜æ•ˆç®¡ç† `nfs_context` è¿æ¥ã€‚
*   **å¼‚æ­¥ä¸çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰æ“ä½œå‡åœ¨ç‹¬ç«‹çš„åå° Isolate ä¸­è¿è¡Œï¼Œç¡®ä¿ UI çº¿ç¨‹å§‹ç»ˆä¿æŒ 60fps æµç•…ã€‚
*   **API åŠŸèƒ½å…¨é¢**: æ”¯æŒ NFSv3/v4 åè®®ï¼ŒåŒ…æ‹¬æ–‡ä»¶åˆ›å»ºã€å†™å…¥ã€ç›®å½•åˆ—è¡¨å’Œæƒé™ç®¡ç†ã€‚

## ğŸ“¦ å®‰è£…

åœ¨ `pubspec.yaml` ä¸­æ·»åŠ  `flutter_nfs`ï¼š

```yaml
dependencies:
  flutter_nfs: ^0.1.0
```

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### 1. åˆå§‹åŒ–

åˆå§‹åŒ–å®¢æˆ·ç«¯ä»¥å¯åŠ¨åå° Worker Isolateã€‚

```dart
import 'package:flutter_nfs/flutter_nfs.dart';

final client = NfsClient();
await client.init();
```

### 2. è¿æ¥ NFS æœåŠ¡å™¨

ä½¿ç”¨ URL æŒ‚è½½ NFS å…±äº«ç›®å½•ã€‚æ”¯æŒæ ‡å‡†çš„ `nfs://` åè®®æ ¼å¼ã€‚

```dart
// æ ¼å¼: nfs://<server>/<export_path>
await client.mount('nfs://192.168.1.100/volume1/shared');
```

**æ³¨æ„**: é»˜è®¤æƒ…å†µä¸‹ï¼Œ`libnfs` å¯èƒ½ä¼šå°è¯•ä½¿ç”¨ç‰¹æƒç«¯å£ã€‚å¯¹äºé Root ç¯å¢ƒï¼ˆç§»åŠ¨è®¾å¤‡å¸¸è§æƒ…å†µï¼‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ NFS æœåŠ¡å™¨å…è®¸éå®‰å…¨ç«¯å£ï¼ˆé€šå¸¸åœ¨ `/etc/exports` ä¸­é…ç½® `insecure` é€‰é¡¹ï¼‰ã€‚

### 3. æ–‡ä»¶æ“ä½œ

#### åˆ—å‡ºç›®å½•
```dart
final entries = await client.listDir('/');
for (var entry in entries) {
  print('${entry.name} - ${entry.isDirectory ? "ç›®å½•" : "æ–‡ä»¶"}');
}
```

#### è¯»å–æ–‡ä»¶
```dart
// ä»åç§»é‡ 0 è¯»å– 1024 å­—èŠ‚
final bytes = await client.read('/data.txt', 0, 1024);
```

#### å†™å…¥æ–‡ä»¶
```dart
final content = utf8.encode('Hello NFS');
// å†™å…¥æ•°æ®åˆ°åç§»é‡ 0
await client.write('/new_file.txt', content, 0);
```

#### æ–‡ä»¶ç®¡ç†
```dart
// åˆ›å»ºæ–‡ä»¶å¤¹
await client.mkdir('/new_folder');

// åˆ›å»ºç©ºæ–‡ä»¶
await client.createFile('/new_folder/empty.txt');

// é‡å‘½å/ç§»åŠ¨
await client.rename('/new_folder/empty.txt', '/new_folder/renamed.txt');

// åˆ é™¤æ–‡ä»¶
await client.delete('/new_folder/renamed.txt');
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

`flutter_nfs` é‡‡ç”¨åˆ†å±‚æ¶æ„ä»¥ç¡®ä¿å®‰å…¨æ€§å’Œæ€§èƒ½ï¼š

1.  **Dart API (`NfsClient`)**: è¿è¡Œåœ¨ä¸» Isolate ä¸­çš„é«˜çº§å¼‚æ­¥ APIã€‚
2.  **Worker Isolate**: ä¸“ç”¨çš„åå°çº¿ç¨‹ï¼Œå¤„ç†æ‰€æœ‰ FFI è°ƒç”¨ï¼Œé˜²æ­¢é˜»å¡ UIã€‚
3.  **FFI Bridge**: Dart `ffi` ç»‘å®šå±‚ï¼Œè¿æ¥åŸç”Ÿ C å‡½æ•°ã€‚
4.  **Native Core (`libnfs`)**:
    *   **Shared Library**: å¤„ç† NFS åè®® (RPC, XDR) çš„ C åº“ã€‚
    *   **NfsPool**: è¿æ¥æ± ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šå¹¶å‘ä¸Šä¸‹æ–‡ã€‚
    *   **BlockCache**: C++ å®ç°çš„ç¯å½¢ç¼“å†²åŒºï¼Œé€šè¿‡é¢„è¯»å–å‡å°‘å° IO è°ƒç”¨æ¬¡æ•°ã€‚

## ğŸ§© æ”¯æŒçš„æ“ä½œ

| æ“ä½œ | æè¿° |
| :--- | :--- |
| `mount` | è¿æ¥æŒ‚è½½ NFS å…±äº«ã€‚ |
| `listDir` | åˆ—å‡ºç›®å½•å†…å®¹åŠå…ƒæ•°æ®ã€‚ |
| `read` | è¯»å–æ–‡ä»¶å­—èŠ‚èŒƒå›´ã€‚ |
| `write` | å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ã€‚ |
| `createFile` | åˆ›å»ºæ–°ç©ºæ–‡ä»¶ã€‚ |
| `mkdir` | åˆ›å»ºæ–°ç›®å½•ã€‚ |
| `delete` | åˆ é™¤æ–‡ä»¶ (`unlink`)ã€‚ |
| `rmdir` | åˆ é™¤ç›®å½•ã€‚ |
| `rename` | é‡å‘½åæˆ–ç§»åŠ¨æ–‡ä»¶/ç›®å½•ã€‚ |
| `truncate` | æˆªæ–­/è°ƒæ•´æ–‡ä»¶å¤§å°ã€‚ |
| `chmod` | ä¿®æ”¹æ–‡ä»¶æƒé™ã€‚ |
| `chown` | ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…ã€‚ |
| `stat` | è·å–æ–‡ä»¶å¤§å°å’Œå±æ€§ã€‚ |

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚å†…éƒ¨ä½¿ç”¨çš„ `libnfs` åº“é‡‡ç”¨ LGPL/GPL è®¸å¯è¯ã€‚
